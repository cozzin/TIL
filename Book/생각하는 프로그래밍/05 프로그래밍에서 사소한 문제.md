# 칼럼 5 - 프로그래밍에서의 사소한 문제

- 많은 프로그래머들이 쉬운길로 가고 싶어함. 바로 코드를 작성하고 잘 작동하기를 바람. 작은 기능을 조작하기 위해 거대한 시스템을 조금씩 더듬어가는 재앙 초래함.
- 영리한 프로그래머는 대신 스캐폴딩을 만듦.
- 스캐폴딩: 초기 프로젝트의 뼈대를 만들어주는 행위를 뜻함. https://www.wisewiredbooks.com/term-dict/common/scaffolding.html

## 5.1 가상코드로부터 C로

4.2절에 있는 가상코드를 C로 바꾸기

```c
// 가상코드의 loop -> C의 무한루프
for(;;) {
    if (l > u)
        return -1;
    ...rest of loop...
}
```

```c
// -> 조건 뒤집어서 while 루프로
while (l <= u) {
    ...rest of loop...
}
return -1;
```

## 5.2 테스트 장치(harness)

1. 손으로 간단한 테스트 해보기
2. 크기가 큰 배열은 테스트 하기 지루함... 그래서 다음과 같은 스캐폴딩 사용

```0
while (scanf("%d %d", &n, &t) != EOF) {
    for (i = 0; i < n ; i++)
        x[i] = 10 * i;
    printf(" %d\n", binarysearch(t));
}
```

이런 스캐폴딩 사용할 때는 디버거보다 print를 사용하는게 더 간단할 수 있음

## 5.3 단정문 사용 요령

- 단정문은 정확히 작성된 프로그램에서도 가끔 실패할 수 있다.
- 배열의 범위를 벗어난 요소에 접근하는 인덱스가 될 수 있음
- 단정문을 조금 약하게 만들기

```c
// 기존
assert(x[u] < t && x[u+1] > t);

// 조건이 약화된 단정문
assert((u < 0 || x[u] < t) && (u+1 >= n || x[u+1] > t));
```

> 그러나 Tony Hoare는 프로그래머가 테스트를 할 때는 단정문을 사용하다가 제품에는 단정문을 제거하는 것은, 
뱃사람이 바닷가에서 연습할 때는 구명조끼를 입다가 바다로 나갈 때 구명조끼를 벗는 것과 같다고 했다.

- 버그에서 우리를 구출해준다는 의미에서 구명조끼를 비유한 것 같음.
- 하지만 유저가 실제로 사용하는 제품에서 assertion을 활용해서 버그를 만났을 때 크래시를 발생시키는 것이 과연 옳은 선택인가?
- assert를 디버그 일 떄 작동시키고, 나머지 경우에는 로그를 남기는 것이 더 낫지 않을까?

> Steve Maguire의 <Writing Solid Code (Microsoft Press, 1993)> 2장은 
고성능 소프트웨어에서의 단정문 사용에 대해 다루고 있다.
그는 Microsoft 제품과 라이브러리에서 단정문을 사용ㅇ하느데 있어 치열했던 이야기를 자세히 설명하고 있다.

- https://www.amazon.com/Writing-Solid-Code-20th-Anniversary/dp/1570740550
- http://www.yes24.com/Product/Goods/15004

## 5.4 자동화된 테스트

가장 작은 값 부터 가장 큰 값까지 반복하며 테스트

```c
for n = [0, maxn]
    print "n=", n
    /* test value n */
```

## 5.5 시간 측정

입력 크기를 증가시켰을 때 logN 에 비례하는지 확인하기

## 5.6 완전한 프로그램

1. 주의깊게 가상코드 유도
2. 분석적 기법 사용해서 정확성 검증 ?
3. 한 줄씩 C로 바꿈. Input/Output 확인
4. 실제 동작과 잘 맞는지 확인하기 위해 코드 곳곳에 단정문을 넣음
5. 이론과 동일하게 실행시간이 적다는 것을 확인
